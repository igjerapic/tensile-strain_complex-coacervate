###################################
### GENERAL SETTINGS FOR THE LAMMPS SCRIPT FOR
### ADHESION TESTING OF A COMPLEX COACERVATE
###################################

neighbor 0.8 bin
neigh_modify one 8000 every 1

###################################
####  GROUPS
####################################

group  pos_chains  type 1
group  neg_chains  type 2
group  chains      type 1 2
group  subs        type 3

####################################
####  POTENTIALS  
####################################

bond_style    fene
bond_coeff    1 30.0 1.5 1.0 1.0  # taken from doi:10.1021/acsmacrolett.5c00323 
bond_coeff    2 0.0 1.5 1.0 1.0 #TODO make box for only one bond?  

special_bonds lj 0.0 1.0 1.0 coul 1.0 1.0 1.0 # taken from Nayan's coacervate paper

dielectric 1.0
variable epsilon_subs equal 3.0 

pair_style lj/cut/coul/long 2.5 10.0  
kspace_style pppm 1.0e-6
kspace_modify slab 3.0 

pair_coeff    * * 1.0 1.0 2.5 
pair_coeff    1*2 1*2 1.0 1.0 2.5 
pair_coeff    1*2 3 ${epsilon_subs} 1.0 2.5 
pair_coeff    3 3 0.0 1.0 2.5  # substrate self-interaction

set group pos_chains charge 1.0 
set group neg_chains charge -1.0

####################################
####  VARIABLES DEFINITION
####################################
variable Temp equal 1.0
variable dt equal 0.005
variable Tdamping equal 100*${dt}

# determine density of coacervate slab
variable mass_chains equal mass(chains)
variable xmin equal bound(chains,xmin)
variable xmax equal bound(chains,xmax)
variable ymin equal bound(chains,ymin)
variable ymax equal bound(chains,ymax)
variable zmin equal bound(chains,zmin)
variable zmax equal bound(chains,zmax)

variable slabVol equal abs(v_xmax-v_xmin)*abs(v_ymax-v_ymin)*abs(v_zmax-v_zmin)
variable slabDensity equal ${mass_chains}/v_slabVol

# adhesion procedure settings 
variable rate equal 0.2
variable compress_density equal 0.85
variable final_dist equal 32.0 
variable max_steps equal ${final_dist}/(${rate}*${dt})

variable velSeed equal 934851
variable thermoT equal 100

####################################
#### THERMO-STYLE
####################################
thermo  ${thermoT}

compute	stressA all stress/atom NULL
compute	p all reduce sum c_stressA[1] c_stressA[2] c_stressA[3]
compute potEng all pe/atom 
compute voronoi chains voronoi/atom 
compute p_slab chains reduce sum c_stressA[1] c_stressA[2] c_stressA[3]

variable	pz equal -(c_p[3])/(vol)
variable	pxy equal -(c_p[1]+c_p[2])/(2*vol)

variable	pz_slab equal -(c_p_slab[3])/(v_slabVol)
variable	pxy_slab equal -(c_p_slab[1]+c_p_slab[2])/(2*slabVol)


thermo_style	custom step time temp ke etotal ebond epair ecoul evdwl enthalpy press v_pxy v_pz v_slabDensity v_p_slab v_pz_slab v_pxy_slab spcpu cpuremain 
thermo_modify line yaml format none
####################################
#### INTEGRATION
####################################
timestep      ${dt}

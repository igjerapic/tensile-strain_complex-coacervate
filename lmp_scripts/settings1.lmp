###################################
### GENERAL SETTINGS FOR THE LAMMPS SCRIPT FOR
### ADHESION TESTING OF A COMPLEX COACERVATE
###################################

neighbor 0.8 bin
neigh_modify one 8000 every 1


####################################
####  POTENTIALS  
####################################

bond_style    fene
bond_coeff    1 30.0 1.5 1.0 1.0  # taken from doi:10.1021/acsmacrolett.5c00323 
bond_coeff    2 0.0 1.5 1.0 1.0 #TODO make box for only one bond?  

special_bonds lj 0.0 1.0 1.0 coul 1.0 1.0 1.0 # taken from Nayan's coacervate paper

dielectric 1.0
variable epsilon_subs equal ${epsilon_PS}

pair_style lj/cut/coul/long 2.5 10.0  
kspace_style pppm 1.0e-6
kspace_modify slab 3.0 

pair_coeff    * * 1.0 1.0 2.5 
pair_coeff    1*2 1*2 1.0 1.0 2.5 
pair_coeff    1*2 3 ${epsilon_subs} 1.0 2.5 
pair_coeff    3 3 0.0 1.0 2.5  # substrate self-interaction

###################################
####  GROUPS
####################################

group  pos_chains  type 1
group  neg_chains  type 2
group  chains      type 1 2
group  subs        type 3

set group pos_chains charge 1.0 
set group neg_chains charge -1.0

####################################
####  VARIABLES DEFINITION
####################################
variable Temp equal 1.0
variable dt equal 0.005
variable Tdamping equal 100*${dt}

# determine density of coacervate slab
variable mass_chains equal mass(chains)
variable xmin equal bound(chains,xmin)
variable xmax equal bound(chains,xmax)
variable ymin equal bound(chains,ymin)
variable ymax equal bound(chains,ymax)
variable zmin equal bound(chains,zmin)
variable zmax equal bound(chains,zmax)
variable z0 equal abs(${zmax}-${zmin})
variable zHalf equal ${z0}/2.0

variable slabVol equal abs(v_xmax-v_xmin)*abs(v_ymax-v_ymin)*abs(v_zmax-v_zmin)
variable slabDensity equal ${mass_chains}/v_slabVol


# adhesion procedure settings 
variable rate equal ${RATE}
variable final_strain equal 3.0 
variable delta_z equal ${final_strain}*${z0}
if "${RATE}==0.0" then "variable runtime equal 25000" else "variable runtime equal round(${delta_z}/(${rate}*${dt}))"
variable velSeed equal 934851
variable thermoT equal 100

###################################
####  REDEFINING TOP AND BOTTOM SUBSTRATE GROUPS 
####################################
region topBox plane 0 0 ${zHalf} 0 0 1
region botBox plane 0 0 ${zHalf} 0 0 -1
group topAtoms region topBox
group botAtoms region botBox

group top_sub subtract topAtoms chains
group bot_sub subtract botAtoms chains

####################################
#### THERMO-STYLE
####################################
compute	stressA all stress/atom NULL
compute	p all reduce sum c_stressA[1] c_stressA[2] c_stressA[3]

variable	pz equal -(c_p[3])/(vol)
variable	pxy equal -(c_p[1]+c_p[2])/(2*vol)

thermo  ${thermoT}
thermo_style	custom step time temp ke etotal ebond epair ecoul evdwl enthalpy press v_pxy v_pz v_slabDensity spcpu cpuremain 
thermo_modify line yaml format none
####################################
#### INTEGRATION
####################################
timestep      ${dt}
